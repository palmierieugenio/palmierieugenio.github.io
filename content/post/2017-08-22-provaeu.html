---
title: provaEU
author: Eugenio Palmieri
date: '2017-08-22'
slug: provaeu
categories:
  - test
tags:
  - test
---

<script src="/./rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/./rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/./rmarkdown-libs/leaflet/leaflet.css" rel="stylesheet" />
<script src="/./rmarkdown-libs/leaflet/leaflet.js"></script>
<link href="/./rmarkdown-libs/leafletfix/leafletfix.css" rel="stylesheet" />
<link href="/./rmarkdown-libs/leaflet-label/leaflet.label.css" rel="stylesheet" />
<script src="/./rmarkdown-libs/leaflet-label/leaflet.label.js"></script>
<script src="/./rmarkdown-libs/Proj4Leaflet/proj4-compressed.js"></script>
<script src="/./rmarkdown-libs/Proj4Leaflet/proj4leaflet.js"></script>
<script src="/./rmarkdown-libs/leaflet-binding/leaflet.js"></script>
<script src="/./rmarkdown-libs/leaflet-providers/leaflet-providers.js"></script>
<script src="/./rmarkdown-libs/leaflet-providers-plugin/leaflet-providers-plugin.js"></script>


<p>PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVAPROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVAPROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA PROVA</p>
<pre class="python"><code># Example of code highlighting
input_string_var = input(&quot;Enter some data: &quot;)
print(&quot;You entered: {}&quot;.format(input_string_var))</code></pre>
<p>Pacchetti:</p>
<pre class="r"><code>library(&quot;ggplot2&quot;)
library(&quot;plotly&quot;)
library(&quot;CatterPlots&quot;)
library(&quot;dplyr&quot;)
library(&quot;sp&quot;)
library(&quot;rgeos&quot;)
library(&quot;leaflet&quot;)</code></pre>
<p>Esempio Mappa:</p>
<pre class="r"><code># Background 1: NASA
m=leaflet() %&gt;% addTiles() %&gt;% setView( lng = 2.34, lat = 48.85, zoom = 5 ) %&gt;% addProviderTiles(&quot;NASAGIBS.ViirsEarthAtNight2012&quot;)
m</code></pre>
<div id="htmlwidget-1" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"maxNativeZoom":null,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"continuousWorld":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":null,"unloadInvisibleTiles":null,"updateWhenIdle":null,"detectRetina":false,"reuseTiles":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addProviderTiles","args":["NASAGIBS.ViirsEarthAtNight2012",null,null,{"errorTileUrl":"","noWrap":false,"zIndex":null,"unloadInvisibleTiles":null,"updateWhenIdle":null,"detectRetina":false,"reuseTiles":false}]}],"setView":[[48.85,2.34],5,[]]},"evals":[],"jsHooks":[]}</script>
<p>Esempi grafici:</p>
<pre class="r"><code># Get the data from the web !
CC &lt;- read.table(&quot;http://www.sr.bham.ac.uk/~ajrs/papers/sanderson06/mean_Tprofile-CC.txt&quot; ,  header=TRUE)
nCC &lt;- read.table(&quot;http://www.sr.bham.ac.uk/~ajrs/papers/sanderson06/mean_Tprofile-nCC.txt&quot; , header=TRUE)
CC$type &lt;- &quot;Cool core&quot;
nCC$type &lt;- &quot;Non-cool core&quot;
A &lt;- rbind(CC, nCC)
 
 
# Make the plot
ggplot(data=A, aes(x=r.r500, y=sckT, ymin=sckT.lo, ymax=sckT.up, fill=type, linetype=type)) + 
 geom_line() + 
 geom_ribbon(alpha=0.5) + 
 scale_x_log10() + 
 scale_y_log10() + 
 xlab(as.expression(expression( paste(&quot;Radius (&quot;, R[500], &quot;)&quot;) ))) + 
 ylab(&quot;Scaled Temperature&quot;)</code></pre>
<p><img src="/./post/2017-08-22-provaeu_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Grafici:</p>
<pre class="r"><code># Funs --------------------------------------------------------------------
 
coord_circle &lt;- function(centre = c(0, 0), r = 1, n = 1000) {
  data_frame(
    x = seq(from = 0 - r, to = 0 + r, length.out = n %/% 2),
    y = sqrt(r^2 - x^2)
  ) %&gt;% bind_rows(., -.) %&gt;%
    mutate(x = x + centre[1], y = y + centre[2])
}
 
 
create_poly &lt;- function(...) {
  args &lt;- list(...)
  SpatialPolygons(
    lapply(
      X = seq_along(args),
      FUN = function(x) {
        Polygons(list(Polygon(as.data.frame(args[[x]]))), names(args)[x])
      }
    )
  )
}
 
 
echancrure &lt;- function(to_var, by_var, p = 0.1) {
  ind &lt;- which(by_var &gt;= -0.08 &amp; by_var &lt;= 0.08 &amp; to_var &gt; 0)
  to_var[ind] &lt;- to_var[ind] - p
  ind &lt;- which(by_var &gt;= -0.08 &amp; by_var &lt;= 0.08 &amp; to_var &lt; 0)
  to_var[ind] &lt;- to_var[ind] + p
  return(to_var)
}
 
 
 
# BB-8 geometries ---------------------------------------------------------
 
 
# droid_body -------------------------------------------------------------------
 
# shape of the droid_body : two circles and a vertical line
droid_body &lt;- coord_circle(centre = c(0, 0), r = 1)
droid_body$xvert &lt;- 0
droid_body$yvert &lt;- droid_body$x
droid_body &lt;- bind_cols(
  droid_body,
  coord_circle(centre = c(0, 0), r = 0.35, n = nrow(droid_body)) %&gt;% select(xint = x, yint = y)
)
 
# grey shapes in the central inner circle
droid_body_rect &lt;- data_frame(
  x = c(-0.5, 0.5, 0.5, -0.5, c(-0.5, 0.5, 0.5, -0.5) - 0.2, c(-0.5, 0.5, 0.5, -0.5) + 0.2),
  y = c(-0.6, 0.4, 0.6, -0.4, c(-0.6, 0.4, 0.6, -0.4) + 0.2, c(-0.6, 0.4, 0.6, -0.4) - 0.2),
  group = rep(1:3, each = 4)
)
# a polygon for calculate the intersection between the grey shapes and the inner circle
polyrect &lt;- create_poly(
  &quot;polyrect1&quot; = droid_body_rect[droid_body_rect$group == 1, 1:2],
  &quot;polyrect2&quot; = droid_body_rect[droid_body_rect$group == 2, 1:2],
  &quot;polyrect3&quot; = droid_body_rect[droid_body_rect$group == 3, 1:2]
)
 
polycircle &lt;- create_poly(
  &quot;polycircle&quot; = droid_body[, c(&quot;xint&quot;, &quot;yint&quot;)]
)
# plot(polyrect); plot(polycircle, add = TRUE)
polyrect &lt;- gIntersection(spgeom1 = polyrect, spgeom2 = polycircle)
# plot(polyrect); plot(polycircle, add = TRUE)
 
# fortify the polygon for ggplot
droid_body_rect &lt;- fortify(polyrect)
 
 
# Central ring (orange)
ring &lt;- coord_circle(centre = c(0, 0), r = 0.4)
ring$y &lt;- echancrure(to_var = ring$y, by_var = ring$x, p = 0.1)
ring$x &lt;- echancrure(to_var = ring$x, by_var = ring$y, p = 0.1)
ring &lt;- bind_rows(
  ring %&gt;% mutate(group = (x &gt;= 0) * 1),
  coord_circle(centre = c(0, 0), r = 0.55, n = nrow(ring)) %&gt;% mutate(y = -y, group = (x &gt;= 0) * 1)
) %&gt;%
  filter(group == 1) # oups something went wrong
ring &lt;- bind_rows(ring, ring %&gt;% mutate(x = -x, group = 2))
 
 
 
 
# ring left and right
# we make a copy of the right part of the central ring
ring_left &lt;- ring %&gt;% filter(group == 1)
# and we shift the ring center
ring_left$x &lt;- ring_left$x - 1.3
 
# the same ...
ring_right &lt;- ring %&gt;% filter(group == 2)
ring_right$x &lt;- ring_right$x + 1.3
 
# we creta a polygon for the intersection with the droid_body circle
polyring &lt;- create_poly(
  &quot;polyring_g&quot; = ring_left[, c(&quot;x&quot;, &quot;y&quot;)],
  &quot;polyring_d&quot; = ring_right[, c(&quot;x&quot;, &quot;y&quot;)]
)
 
polydroid_body &lt;- create_poly(&quot;polydroid_body&quot; = droid_body[, c(&quot;x&quot;, &quot;y&quot;)])
 
# plot(polyring); plot(polydroid_body, add = TRUE)
 
polyring &lt;- gIntersection(spgeom1 = polyring, spgeom2 = polydroid_body)
fort_ring &lt;- fortify(polyring)
 
 
# the horizontal line of the body (in two parts)
ligne_hori &lt;- data_frame(
  x = c(-1, range(ring$x), 1),
  y = 0,
  group = c(1, 1, 2, 2)
)
 
 
# droid head --------------------------------------------------------------------
 
droid_head &lt;- coord_circle(centre = c(0, 1.02), r = 0.52) %&gt;%
  filter(y &gt;= 1.02) %&gt;%
  mutate(group = 1, fill = &quot;white&quot;, col= &quot;black&quot;) %&gt;%
  bind_rows(
    data_frame(
      x = c(-0.52, -0.4, 0.4, 0.52),
      y = c(1.02, 0.95, 0.95, 1.02),
      group = 2, fill = &quot;white&quot;, col= &quot;black&quot;
    )
  )
 
 
 
# Grey bars in droid&#39;s head
poly_head_grey &lt;- create_poly(
  &quot;poly_head_grey_haut&quot; = data_frame(
    x = c(-0.52, 0.52, 0.52, -0.52),
    y = c(1.44, 1.44, 1.51, 1.51)
  ),
  &quot;poly_head_grey_bas&quot; = data_frame(
    x = c(-0.52, 0.52, 0.52, -0.52),
    y = c(1.02, 1.02, 1.07, 1.07)
  )
)
 
polydroid_head &lt;- create_poly(&quot;polydroid_head&quot; = droid_head[droid_head$group == 1, c(&quot;x&quot;, &quot;y&quot;)])
 
poly_head_grey &lt;- gIntersection(spgeom1 = poly_head_grey, spgeom2 = polydroid_head)
fort_droid_headrectgris &lt;- fortify(poly_head_grey)
 
 
 
# orange bars
poly_head_orange &lt;- create_poly(
  &quot;poly_head_orange1&quot; = data_frame(
    x = c(-0.52, 0.52, 0.52, -0.52),
    y = c(1.38, 1.38, 1.42, 1.42)
  ),
  &quot;poly_head_orange2&quot; = data_frame(
    x = c(-0.35, -0.35, -0.2, -0.2),
    y = c(1.07, 1.15, 1.15, 1.07)
  ),
  &quot;poly_head_orange3&quot; = data_frame(
    x = c(-0.55, -0.55, -0.45, -0.45),
    y = c(1.07, 1.15, 1.15, 1.07)
  ),
  &quot;poly_head_orange4&quot; = data_frame(
    x = c(0.44, 0.44, 0.47, 0.47),
    y = c(1.07, 1.15, 1.15, 1.07)
  )
)
 
poly_head_orange &lt;- gIntersection(spgeom1 = poly_head_orange, spgeom2 = polydroid_head)
fort_droid_headrectorange &lt;- fortify(poly_head_orange)
 
 
polygones_droid_head &lt;- bind_rows(
  fort_droid_headrectgris %&gt;% select(-piece) %&gt;%
    mutate(group = as.numeric(as.character(group)), fill = &quot;#8E8E9C&quot;, col= &quot;black&quot;),
  fort_droid_headrectorange %&gt;% select(-piece) %&gt;% 
    mutate(group = as.numeric(as.character(group)) * 2, fill = &quot;#DF8D5D&quot;, col= &quot;black&quot;)
)
 
 
# Eyes
droid_eyes &lt;- bind_rows(
  coord_circle(centre = c(0, 1.35), r = 0.14) %&gt;% mutate(group = 1, fill = &quot;white&quot;, col = &quot;white&quot;),
  coord_circle(centre = c(0, 1.35), r = 0.12) %&gt;% mutate(group = 2, fill = &quot;white&quot;, col = &quot;black&quot;),
  coord_circle(centre = c(0, 1.35), r = 0.10) %&gt;% mutate(group = 3, fill = &quot;grey40&quot;, col = &quot;grey40&quot;),
  coord_circle(centre = c(0, 1.35), r = 0.08) %&gt;% mutate(group = 4, fill = &quot;black&quot;, col = &quot;black&quot;),
  coord_circle(centre = c(0, 1.16), r = 0.04) %&gt;% mutate(group = 5, fill = &quot;#76B1DE&quot;, col = &quot;black&quot;),
  coord_circle(centre = c(0.25, 1.20), r = 0.08) %&gt;% mutate(group = 6, fill = &quot;black&quot;, col = &quot;black&quot;),
  coord_circle(centre = c(0.25, 1.20), r = 0.07) %&gt;% mutate(group = 7, fill = &quot;white&quot;, col = &quot;black&quot;),
  coord_circle(centre = c(0.25, 1.20), r = 0.06) %&gt;% mutate(group = 8, fill = &quot;grey40&quot;, col = &quot;grey40&quot;),
  coord_circle(centre = c(0.25, 1.20), r = 0.04) %&gt;% mutate(group = 9, fill = &quot;black&quot;, col = &quot;black&quot;)
)
 
eye_line &lt;- data_frame(
  x = 0,
  y = c(1.07, 1.16-0.04)
)
 
# Antennas
antennas &lt;- data_frame(
  x = c(0.01, 0.01, 0.10, 0.10),
  y = c(sqrt(0.52^2 - 0.01^2) + 1.02, sqrt(0.52^2 - 0.01^2) + 1.02 + 0.15,
        sqrt(0.52^2 - 0.1^2) + 1.02, sqrt(0.52^2 - 0.1^2) + 1.02 + 0.25),
  group = c(1, 1, 2, 2)
)
 
 
# bb-8/ggplot2 ------------------------------------------------------------
 
bb8 &lt;- ggplot(data = droid_body) +
  coord_fixed() +
  geom_polygon(mapping = aes(x = x, y = y), fill = &quot;white&quot;, col = &quot;black&quot;) +
  geom_polygon(data = droid_body_rect, mapping = aes(x = long, y = lat, group = group), fill = &quot;#8E8E9C&quot;) +
  geom_path(mapping = aes(x = xvert, y = yvert)) +
  geom_path(mapping = aes(x = xint, y = yint)) +
  geom_polygon(data = ring, mapping = aes(x = x, y = y, group = group), fill = &quot;#DF8D5D&quot;, col = &quot;#DF8D5D&quot;) +
  geom_path(data = ligne_hori, mapping = aes(x = x, y = y, group = group)) +
  geom_polygon(data = fort_ring , mapping = aes(x = long, y = lat, group = group), fill = &quot;#DF8D5D&quot;) +
  geom_polygon(data = droid_head, mapping = aes(x = x, y = y, group = group, fill = fill, col = col)) +
  geom_polygon(data = polygones_droid_head, mapping = aes(x = long, y = lat, group = group, fill = fill, col = col)) +
  geom_polygon(data = droid_eyes, mapping = aes(x = x, y = y, group = group, fill = fill, col = col)) +
  scale_fill_identity() + scale_color_identity() +
  geom_line(data = eye_line, mapping = aes(x = x, y = y)) +
  geom_line(data = antennas, mapping = aes(x = x, y = y, group = group), col = &quot;black&quot;)
 
 
bb8</code></pre>
<p><img src="/./post/2017-08-22-provaeu_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code># or
bb8 + theme_void()</code></pre>
<p><img src="/./post/2017-08-22-provaeu_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
<pre class="r"><code>ggplot(iris, aes(x=Sepal.Length, y=Sepal.Width)) + 
    geom_point()</code></pre>
<p><img src="/./post/2017-08-22-provaeu_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<pre class="r"><code>x &lt;- -10:10
y &lt;- -x^2 + 10
meow &lt;- multicat(xs=x, ys=rnorm(21),
                 cat=c(1,2,3,4,5,6,7,8,9,10),
                 catcolor=list(c(0,0,0,1)),
                 canvas=c(-0.1,1.1, -0.1, 1.1),
                 xlab=&quot;some cats&quot;, ylab=&quot;other cats&quot;, main=&quot;Random Cats&quot;)</code></pre>
<p><img src="/./post/2017-08-22-provaeu_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
